#include "mcinter.h"

void Mcinter::initialize() {
  Parser myParser(myFuncs);
  std::string funcName = myParser.parseFuncName(expr);
  func = (*myFuncs)[funcName];
  Expression * myTrials = myParser.parse(expr);
  trials = myTrials->evaluate();
  delete myTrials;
  for (size_t i = 0; i < func->getArgs().size(); ++i) {  //what if not enough
    Expression * low = myParser.parse(expr);
    Expression * high = myParser.parse(expr);  //check result???
    argv.push_back(std::pair<double, double>(low->evaluate(), high->evaluate()));
    delete low;
    delete high;
  }
}
/*
double Mcinter::getRanDou(double low, double high) {
  unsigned seed = std::chrono::system_clock::now().time_since_epoch().count();
  std::default_random_engine generator(seed);
  std::uniform_real_distribution<double> distribution(low, high);
  return distribution(generator);
}
*/
double Mcinter::getRanDou(double low, double high) {
  srand((unsigned)time(NULL));
  double myDouble = ((double)rand() * ((high - low) / RAND_MAX) + low);
  std::cout << myDouble << "\n";
  return myDouble;
}
std::vector<double> Mcinter::getRanDouVec() {
  std::vector<double> douVec;
  srand((unsigned)time(NULL));
  for (size_t i = 0; i < func->getArgs().size(); ++i) {
    double myDouble =
        ((double)rand() * ((argv[i].second - argv[i].first) / RAND_MAX) + argv[i].first);
    std::cout << myDouble << "\n";
    douVec.push_back(myDouble);
    //    douVec.push_back(getRanDou(argv[i].first, argv[i].second));
  }
  return douVec;
}
double Mcinter::integrate() {
  double funcAvg = 0;
  for (int i = 0; i < trials; ++i) {
    func->setViaDou(getRanDouVec());
    funcAvg += (func->evaluate() / trials);
  }
  return funcAvg * multipleRanges();
}
double Mcinter::multipleRanges() {
  double product = 1;
  for (size_t i = 0; i < argv.size(); i++) {
    product *= (argv[i].second - argv[i].first);
  }
  return product;
}
